## Introduction

On a large scale, when we have a big automation setup like the one designed
for a villa, an entire building or perhaps even bigger, like it could be the
one designed for a smart city, it is required to decentralize the whole
system by having a convenient number of local controller units that are
able to communicate each other and work like a single big coordinated
entity.

<div class="media-container">
    <img self="size-small" title="Interconnected HGs in a big setup" src="images/docs/villa.jpg">
</div>

## HomeGenie Interconnections

During the development of HomeGenie, there was one vision behind the whole
design process, a paradigm to follow, which was the one of the
*Central Nervous System*. 

Following that paradigm, a single HomeGenie unit can thus be imagined
as a *[nerve cell](https://en.wikipedia.org/wiki/Neuron)* that process
and transmit information through event signals.
The way those information are processed by a local unit is governed by
the **APE** ([Automation Program Engine](#/develop/programs)) and by all
programs defined into it.

In fact, automation programs can receive signals (events) from any local or
remote module and external services and may react generating other signals
that are then processed and propagated through the system.

So each local HomeGenie can have its own intelligence but can also cooperate
and handle external signals and modules in a coordinated way within a bigger
interconnected system, even though heterogeneous.

<!--div class="media-container">
    <img self="size-small" title="Interconnected HGs in a big setup" src="images/docs/chemical_synapse.jpg">
</div-->

### Event forwarding

The quickest way to interconnect HomeGenie servers is by enabling *"Interconnections &rarr; Forwarding"*
programs from the *"Automation &rarr; Programs"* page.

This kind of interconnection is achieved by forwarding of signals generated by modules on one
server to another HomeGenie server. When a server receive signals from a remote module,
automatically creates a local instance of that module, treating it as if it were a local one.

So every command issued on that module will be automatically forwarded to the remote server
to which that module belongs to.

This also means that interconnected server can carry on automation tasks involving remote
modules and that can also be conditioned by the status of remote modules.

There are various types of event forwarding:

- `Sensor.*` - sensors parameter updates
- `Status.*` - smart lights and switches level updates
- `Receiver.RawData` - IR/RF remote controllers button press
- `Meter.Watts` - smart metering devices value updates

<div class="media-container">
    <img self="size-medium" src="images/docs/interconnections_01.png" />
</div>

After activating the type of forwarding we want to use, we can configure
the remote server to interconnect to, from the *"Configure &rarr; Settings"* page.

All modules generating events matching the type of activated forwarding programs
will be so exported to the remote server as well.

<div class="media-container">
    <img self="size-medium" src="images/docs/interconnections_02.png" />
</div>

On the remote server end, all modules originated from this interconnection will
have the prefix `HGIC:<interconnected_server_ip>.` in the *domain* field of
the module address.

<div class="media-container">
    <img self="size-medium" src="images/docs/interconnections_03.png" />
</div>

#### Remarks

`[...] // TODO: add note about user/pass protection and remote modules controlling`

### Interconnecting via MQTT

`[...]`

<!--

### Centralized or decentralized?

`[...]`

More in general, by interconnecting more HomeGenie boxes we can:

- Balance and distribute all automation tasks between HG servers and still see the whole as a single entity
- Design our home automation network as centralized or make it behave like a grid network, or a mix of both

-->
